# Image Classification for Food And Skin Disease Dataset

This repository contains the second midterm project for the "Principles of Artificial Intelligence" course offered by the Department of Automation at Tsinghua University. This project focuses on the classification of food dataset or skin disease dataset. 

## Models

Six models are realized in the directory `models`, including:

- **AlexNet** without batch normalization and dropout: `AlexNet` in `alexnet.py`.
- **AlexNet** with batch normalization and dropout: `AlexNetPro` in `alexnet.py`.
- **VGG11** without batch normalization and dropout: `VGG11` in `vgg11.py`.
- **VGG11** with batch normalization and dropout: `VGG11Pro` in `vgg11.py`.
- **ResNet** without batch normalization: `ResNet` in `ResNet.py`.
- **ResNet** with batch normalization: `ResNetPro` in `ResNet.py`.

The structure of the networks are shown below:

![](figure/network.png)

## Training

We train each model with batch size 64, learning rate 0.01, and number of epochs 30. The results are shown in the following table.

| Model      | Training loss | Test accuracy |
| ---------- | ------------- | ------------- |
| AlexNet    | ![](checkpoints/alexnet_food/Training_loss.png) | ![](checkpoints/alexnet_food/Test_accuracy.png) |
| AlexNetPro | ![](checkpoints/alexnetpro_food/Training_loss.png) | ![](checkpoints/alexnetpro_food/Test_accuracy.png) |
| VGG11      | ![](checkpoints/vgg11_food/Training_loss.png) | ![](checkpoints/vgg11_food/Test_accuracy.png) |
| VGG11Pro   | ![](checkpoints/vgg11pro_food/Training_loss.png) | ![](checkpoints/vgg11pro_food/Test_accuracy.png) |
| ResNet     | ![](checkpoints/resnet_food/Training_loss.png) | ![](checkpoints/resnet_food/Test_accuracy.png) |
| ResNetPro  | ![](checkpoints/resnetpro_food/Training_loss.png) | ![](checkpoints/resnetpro_food/Test_accuracy.png) |

One can train the model using the following command:

```bash
python train.py \
    --model_name alexnet \
    --dataset food \
    --learning_rate 0.01 \
    --batch_size 64 \
    --num_epochs 30
```

## Evaluation

One can evaluate the model on the dataset using the following command:

```bash
python eval.py \
    --dataset food \
    --model_path checkpoints/alexnet_food
```

## CLI

We provide cli for user to classify any figure using the trained model:

```bash
python cli.py --model_path checkpoints/alexnetpro_food/
```

Then user can input the path to the desire figure to get the classification. We use the trained AlexNetPro model as an example:

![](figure/cli.png)

## Visualization 

We use Grad-CAM to visualize the decision process of the networks, using [pytorch-grad-cam](https://github.com/jacobgil/pytorch-grad-cam.git). To install:

```bash
pip install grad-cam
```

To generate the Grad-CAM figure:

```bash
python cam.py --image_path data/Food-101-archive/apple_pie/68383.jpg --model_path checkpoints/alexnetpro_food/ --target_class 0
```

The class number corresponding to the classes is in `utils.constants.py`.

The Grad-CAM figures generated by each model is shown below (as an example):

| Original Figure | AlexNetPro | VGG11Pro | ResNetPro |
| --------------- | ---------- | -------- | --------- |
| ![](figure/cam_example/apple_pie.jpg) | ![](figure/cam_example/apple_pie_alexnetpro.jpg) | ![](figure/cam_example/apple_pie_vgg11pro.jpg) | ![](figure/cam_example/apple_pie_resnetpro.jpg) |
| ![](figure/cam_example/beet_salad.jpg) | ![](figure/cam_example/beet_salad_alexnetpro.jpg) | ![](figure/cam_example/beet_salad_vgg11pro.jpg) | ![](figure/cam_example/beet_salad_resnetpro.jpg) |
| ![](figure/cam_example/dumplings.jpg) | ![](figure/cam_example/dumplings_alexnetpro.jpg) | ![](figure/cam_example/dumplings_vgg11pro.jpg) | ![](figure/cam_example/dumplings_resnetpro.jpg) |
| ![](figure/cam_example/fish_and_chips.jpg) | ![](figure/cam_example/fish_and_chips_alexnetpro.jpg) | ![](figure/cam_example/fish_and_chips_vgg11pro.jpg) | ![](figure/cam_example/fish_and_chips_resnetpro.jpg) |
| ![](figure/cam_example/ice_cream.jpg) | ![](figure/cam_example/ice_cream_alexnetpro.jpg) | ![](figure/cam_example/ice_cream_vgg11pro.jpg) | ![](figure/cam_example/ice_cream_resnetpro.jpg) |
| ![](figure/cam_example/pizza.jpg) | ![](figure/cam_example/pizza_alexnetpro.jpg) | ![](figure/cam_example/pizza_vgg11pro.jpg) | ![](figure/cam_example/pizza_resnetpro.jpg) |
